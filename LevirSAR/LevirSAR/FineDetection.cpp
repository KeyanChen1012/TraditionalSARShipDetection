#include "FineDetection.h"
#include "GetROIs.h"

FineDetection::FineDetection()
{
    this->m_hog = new HOGDescriptor(Size(64, 64), Size(16, 16), Size(8, 8), Size(8, 8), 9);
	this->m_w = new double[1764]{-0.363187819016383, -0.625389244206372, 0.890920264570390, 0.436118273321907, 0.0985595461665371, -0.557893383846028, 0.348686225893393, 0.198748866875897, -0.515239980996034, 0.253254130024586, 0.399104177886502, 0.502929677930540, 0.248191398308592, -0.346321890275715, -0.477070095204423, 0.316784127570874, 0.542623559578799, -0.333163016084108, -0.0629854860677565, 0.0601766832795186, 0.00466303659201844, -0.537628836455378, 0.236127144450161, -0.143212529355845, 0.530910788345413, 0.0580471653750969, -0.173555001425589, 0.572141351817452, 0.225513928119215, -0.0322615202929589, -0.379846504611727, -0.0917766609387450, -0.122298672605359, -0.109341945069233, 0.268317980746496, -0.317432371715111, -0.148956145293275, 0.176722995874704, 0.343635821937669, 0.310680733393852, -0.263847574683951, 0.0200695921958099, 0.459360555128752, 0.208036455772865, -0.705693174669764, -0.128998093597321, -0.101755311041159, 0.0981098424244172, 0.00768178311686775, -0.292629319133340, -0.127344291553420, 0.331376006614176, -0.00756934003420307, -0.388410523757212, 0.186179258283716, -0.252788886487833, 0.0489619769184218, 0.194022859091321, -0.200992055654805, 0.384024173868579, 0.449726553722260, 0.519090173929754, 0.278419455900362, 0.922213187350045, 0.0787831945223237, -0.374581309563153, 0.231637828742330, 0.688828182102568, -0.249811571676592, 0.187722878870683, 0.151445618161741, 0.106450077103710, 0.138584433648846, 0.486392617470069, 0.795475633968413, 0.301099488057583, -0.144514388113628, -0.558550846502122, 0.0219607417985963, -0.0585852409079022, 0.674830509929059, -0.288329493888090, 0.372897913693538, 0.246780968770337, -0.325958182146605, -0.421690971451422, -0.0516239869676889, 0.351316783079469, -0.321050385909782, 0.0148899519766127, 0.362754085850400, 0.0220090981812564, 0.888044903826500, 0.203782556463268, 0.177302593799417, 0.691674146712726, 0.791945661422474, -0.0411290873868773, 0.209356901018772, -0.452917320501766, 0.234232865620342, -0.201781097223959, -0.0294588096235246, 0.296555848769967, 0.0721466685842482, -0.0567602672709973, 0.0720862259966271, 0.565607835354552, 0.188159390744103, 0.548451319682014, 0.0744582400946081, -0.0195285602288611, -0.131271549034566, 0.0482799911934049, 0.398318744505833, -0.374486525159767, -0.703274329828127, 0.487170908561608, -0.149029857332741, 0.262726604340784, -0.164569321079817, -0.0515884087424074, -0.263939341886696, 0.592923410268287, 0.245368588363441, 0.427514925046079, -0.149842941468187, 0.529526444560284, -0.409890831826218, 0.487544537881472, 0.246777657711726, 0.213330235834036, -0.00974281018842794, 0.294600245485897, 0.410794688281148, -0.241391057110995, 0.459205891171833, 0.422487695174297, 0.475216032093232, 0.132762147356456, -0.264733659883897, 0.707372723618350, 0.925108406086863, 0.0298823449536987, -0.0267270443148449, 0.491366659822902, 0.337147671539989, -0.259036900772137, -0.419185502960735, 0.0166164062726349, 0.281259505927949, 0.331078808482027, -0.0725297229140227, 0.334985944449875, 0.161494475577763, 0.283530387796891, 0.314182890517494, 0.0379960235520225, -0.0907616034848927, 0.500323745630436, 0.328448891388135, -0.324765424288372, 0.193312148583970, -0.312653850692901, 0.00432392480004199, 0.0741140399006972, 0.0892536942711041, 0.325372416773512, 0.0879852653340403, 0.343957671018412, -0.402013438677053, 0.160477310508794, 0.219757926183778, -0.0304182751145921, -0.0834717548720740, -0.0415515682562817, -0.0402286456343038, -0.126851124696251, 0.194516546701493, 0.278774011168316, -0.195120076363450, -0.0359920972356931, 0.354565647982215, -0.359875482924869, -0.218780276209794, -0.302010001764742, -0.00906803491420649, 0.0972132253884506, -0.329157422805188, -0.454467119312016, 0.407138755399829, -0.239222447353966, -0.190123086355833, 0.171983851021715, 0.0567113583772281, 0.0353723916385532, 0.149546588865805, -0.131671691830429, 0.450954812091294, -0.120259746304073, -0.0768346537389251, -0.274842378052959, -0.0464461501481836, 0.0810452076798004, -0.0625881091108962, -0.546375978701898, 0.426303814702333, 0.342360418955605, 0.145296189140728, 0.139770010279070, -0.564595394495908, 0.364658529699624, -0.626445603831242, -0.0834158195501644, -0.0230005067474616, 0.509836891755918, -0.438405712979732, 0.136052892279063, 0.109931738904567, -0.395751538557871, 0.393045587594829, 0.0972592986690472, -0.325165248614557, -0.958498314625604, -0.0316579933606349, 0.737319179092536, -0.0827195849108352, -0.106093216075072, -0.415078132827498, 0.111272250000607, 0.0731449866480138, -0.257754736967450, 0.0410637997667428, 0.823821152413954, -0.507989135461096, -0.207824939867417, 0.144758140271921, -0.399919312521451, 0.151791168745913, 0.394079831797946, 0.625717435028596, -0.330114444095110, 0.0679365532054100, 0.334509200614231, 0.115335460984639, 0.285844080604953, 0.557416031424047, 0.628123102643856, 0.0767075255771002, 0.145538248742731, -0.0883901207709199, -0.109815845032259, 0.0720493451129117, 0.216291652841445, -0.200278533630293, -0.334769059221934, 0.191536326504286, -0.349144278754278, -0.183661276245860, -0.237960461461313, 0.441182405879613, 0.394672062220821, 0.217070460421837, -0.373103957261404, -0.912757829292723, -0.261884985702729, 0.492927680135347, -0.0229271936665062, 0.155494810633752, -0.236547687477244, -0.0258127669568731, 0.133848287645651, 0.301697460902592, 0.293607543576373, 0.878070073688515, 0.107789270778092, -0.0743220766613429, 0.371916439337577, 0.478116673826167, -0.136678637851784, 0.320295920485138, -0.120478799344860, -0.318437712747037, -0.325839317694719, -0.542223092640144, 0.394619374601929, -0.243628043438482, -0.0491588096875967, -0.335135389223884, -0.416243857427523, 0.145331247463429, 0.00573903294828632, -0.379609261879227, -0.559137275357298, -0.232359335187226, -0.00739125096520236, 0.258219282160945, -0.0876436092376311, -0.0428264700248296, 0.0587895593241075, 0.392203788873605, 0.428863209876905, -0.926749232731821, 0.00123439229388088, 0.0689015247058720, -0.124865669857005, 0.141389627763231, 0.806292655550381, 0.164892119060873, -0.0545766342766042, 0.445930506051536, 0.137915130392370, 0.197851565642361, 0.380542509119110, 0.319327038740299, 0.0615178912930866, 0.0895006239197435, 0.204230485586688, 0.357630256972564, 0.541301625869241, 0.195046074089960, -0.282366991777745, 0.276566888820746, -0.245019949375084, 0.590872891146602, -0.399506564914397, -0.134169133201013, -0.399636104025160, -0.0432714379181952, -0.148377632655612, 0.260903230912364, -0.462570632385275, -0.233084540742789, -0.449936383883786, -0.382022498850437, 0.335064821476128, 0.259230766156928, 0.136312070595760, 0.624808980396826, -0.204450035940746, 0.0617599921902255, -0.224658378804336, 0.628093092827318, -0.282160868846361, -0.0551503990036203, -0.151922458162457, 0.379782499332646, 0.484354004263094, 0.264186830649678, 0.570820758922323, 0.274436073606121, 0.291757730459881, -0.224436432138246, 0.524310476625667, -0.671065525555357, -0.399769007130161, -0.0970941655312941, -0.142268419845769, -0.0464154727275461, 0.338703396471413, -0.779735968927137, 0.426196236754488, 0.483845953205498, 0.0642554409111513, -0.523447829190614, -0.991265200088771, -0.514228203061648, -0.194231231886474, -0.553494274582631, -0.481904204144776, -0.476811386751289, -0.0706690790390757, -0.334684325865340, -0.605087932461995, -0.918702694509011, -0.406155134989766, 0.381979310964651, -0.238220534554185, -0.581681506683013, 0.0221486753273518, 0.901554946992544, -0.126299936402478, -0.208327251705909, -0.00645569192004709, 0.289156439728647, 0.543709206630813, 0.206373419581202, -0.280453805839214, 0.0262970142536525, 0.0635768867900844, 0.280825531098710, 0.638982302193945, -0.0805974798914451, 0.203442039148307, 0.260173501013187, -0.0599260868004952, 0.00711272552734019, -0.390038684450211, -0.609855895435086, -0.219496753160254, 0.375279988768308, 0.0423371028575104, -0.0928213590544633, 0.421666940841444, -0.186590075776396, -0.621544563232984, 0.319228807034472, -0.184295761386826, -0.529502594519056, 0.297509041091055, 0.249389864371339, -0.00492447805041754, -0.349998694864811, 0.0790832559717490, 0.651040522560880, 0.536781779015587, 0.204633764080099, 0.119780182802855, 0.262603030678804, -0.380375353328473, -0.178561646495458, 0.349897490807207, 0.245369005411315, 0.455386935485620, 1.01369802699251, 0.545174036021990, 0.0482905680026533, 0.320327930136932, 0.0652234814745332, -0.281267545807301, 0.0509622215853979, 0.321631700390172, 0.392373431023628, 0.580060856986851, -0.0771858407428469, -0.0172537646998371, 0.0387231780122483, -0.0152559225154849, 0.350227816072067, -0.260360699896913, 0.100598381120860, -0.260734326628113, -0.125213462521680, -0.450218296359158, -0.588484391443395, -0.524196711645045, -0.720440389030976, 0.422051547383514, 0.132574289252981, 0.261841741662268, -0.278356563546276, 0.116218353789640, 0.135790583067623, -0.283797593424111, 0.508418967351725, 0.756090752044286, 0.397862039702983, -0.387668968867733, 0.0382747537195911, 0.223465732612368, 0.0927361981214654, 0.174551575128568, -0.283333471740643, -0.816670522790346, 0.386982867164214, 0.00202779874402190, -0.232172311903635, 0.325872523279530, -0.384225308320770, -0.222078015578022, 0.727420783187989, 0.285774553279571, 0.0343556162017059, -0.114554416055992, 0.0779132177327695, 0.0907832805129656, -0.0910709908133368, -0.0115060134365936, 0.268010017769757, -0.396281715650461, -0.534420541943046, 0.0609661650080453, -0.0860192315190304, 0.612559665001447, 0.355491798312794, -0.0574898200590567, 0.206617407069705, -0.311132119137069, 0.517075261907811, 0.126999607247295, -0.611840146076563, -0.0679186376062722, -0.527522712327631, 0.556066990190971, 0.352226431581265, -0.146847085827743, 0.502233844218650, 0.0856915077907563, -0.00588249340285628, 0.611299934482091, -0.292580961453685, 0.230713990107659, 0.0774611440318731, 0.189449474710205, -0.449166271067326, -0.393332395143967, 0.0969269792636205, -0.789206099008864, 0.0172066752430055, -0.763822213330157, 0.216075803847105, 0.213798843783857, -0.313789221832083, -0.286555418339911, -0.205886757981257, 0.327166205858748, -0.161712811619338, -0.137430145190827, -0.400493144099069, 0.360422623522745, 0.432607029231190, -0.0971595762197174, -0.0576128749853342, 0.172435833533147, 0.566128264270040, -0.525479336734711, -0.0910752005677380, -0.381587796711861, 0.352007666174388, -0.143666205372823, -0.276406365810985, -0.639212512963877, 0.241202539218884, 0.811894940587888, 0.194139247367431, 0.660045327276688, -0.248166598320902, -0.166840918791999, -0.0882300758227728, 0.483061996252786, -0.534678723512021, -0.277340233551190, -0.140418410680846, 0.0722148703548901, -0.400637290397251, -0.397479129826082, 0.293273304801544, -0.0744208821696408, -0.670921725778072, -0.322256878899810, -1.07694989247701, -0.501679675671282, -0.0845855504054456, 0.253309366281635, -0.188558272422591, 0.254650175391556, 0.402366640059189, -0.266055701479111, 0.497541395215189, -0.214194149760483, 0.0698688598416355, 0.243517887050687, 0.507497202082553, -0.240076972276598, -0.302271818484280, -0.209856033358733, 0.517239282125833, 0.271802240134529, -0.228368413313843, 0.0256834661024107, 0.293315449484283, 0.177277083347588, -0.435432033910267, 0.240751322837035, -0.0982364657794772, -0.0732799403356665, -0.527866096646513, -0.415177997634810, -0.113926347981237, -0.337313819978179, -0.0524096060585658, -0.591770697958191, -0.890419737854995, -0.474996529729282, -0.188301301387482, 0.324423662641745, 0.180167659016896, 0.0896931162599089, -0.229131948214733, 0.361271685007223, 0.550655648431256, 0.256152321444765, 0.393691209917948, -0.257264391519154, 0.0706244043832962, -0.0573800000502701, -0.119203267833255, -0.259787031821186, 0.328914158710039, 0.274633470883603, 0.648931603756501, -0.0848081722451839, 0.215264538594154, 0.168841318634455, 0.0811554957271362, -0.426710758763040, -0.376232690527642, -0.117816685133338, 0.0487270111176846, 0.902777559907529, 0.654278202677227, 0.137501386543340, -0.882584635522816, -0.874875911357549, 0.0418523946329837, -0.235259247097280, 0.502763428005029, -0.192192104954898, -0.585359128752810, -0.246172081203249, -1.00955777143854, -0.152853184771859, -0.542208791329685, -0.164750614727992, -0.322090066398312, 0.241096000318450, -0.113812549426912, -0.348746850023610, -0.429866558851510, -0.709153130755791, -0.353578883795841, -0.401278736583270, 0.628797825114803, 0.110300168318695, -0.312059831771116, -0.104740569039350, -0.418857291487253, 0.349622684272883, -0.453744559727414, 0.297657634914659, -0.285136545589813, 0.104816050547276, -0.313607406292274, 0.0803184504959695, -0.569462363650103, -0.239031571798224, 0.211099819781981, -0.363726134681065, 0.0796542601520299, 0.0827348747649944, 0.453229712519185, -0.0852496066444372, 0.124321509465934, 0.300966053163680, 0.447825122835695, -0.360835005898442, -0.391802570188596, -0.693399361575422, -0.360491473397345, -0.438532999110276, -0.439635643108723, -1.10663682770938, -0.537957679779616, -0.0479190133895338, -0.0978265785290198, -0.569456277343352, 0.165339253888350, -0.415096948159903, 0.399952565548785, 0.308862902759699, 0.841993751217093, -0.134569366501559, 0.691827425847965, -0.148209155669723, -0.160569972143848, 0.0984786407492967, -0.136792500417239, -0.122876266245927, -0.0538145387048514, -0.277281383322084, -0.314723144275338, -0.320430987082976, -0.221283167664094, 0.331487359141087, -0.453028516571184, 0.140368105677396, -0.331950999866460, -0.101376970715467, -0.652366144619378, -0.358608195449998, -0.210400172670312, -0.346396158172595, -0.478019946730368, 0.448058204989887, 0.221858401121742, -0.283113617161252, -0.583120981444615, -0.715141094615718, -0.259015975398248, -0.592828675814809, -0.0895604375059916, -0.354338931520048, 0.00329391879233396, 0.165657523085944, -0.0270327808515468, -0.0658301252165605, 0.111824595258272, 0.820529346487806, 0.245303402679568, 0.370027864980326, 0.151637765709042, 0.351403719369371, -0.166465553671566, 0.104004482215398, -0.136083778694284, 0.0220022052461695, 0.488027802801287, 0.299684846729680, 0.344071339325899, 0.00659426200635855, -0.102760649946255, -0.160141504206817, -0.529583330354737, 0.110888432249564, -0.633680150183000, -0.404730398524115, -0.176931106143164, 0.226479613979496, 0.150070751807462, -0.272705232367000, 0.254463059250280, -0.145809167037045, -0.363360931297619, 0.251240171518326, -0.309210138612110, 0.285130735814489, -0.292791492742319, -0.267854912918163, -0.328867602350659, -0.308671580269539, -0.0562672689747966, 0.482550357744414, -0.0450481752105307, -0.523928935671699, 0.286532325009845, 0.0485230242291249, -0.0444979091107495, 0.217049550244938, 0.106257601632414, -0.529139536259085, -0.665341246300951, 0.0868836407210702, -0.896718586912034, 0.428924647991821, 0.300533360609018, 0.587233529913520, 0.239266641355532, -0.0562080945739670, -0.183206477647693, -0.0964402343814017, 0.0496265125655613, -0.315138613377633, -0.0448788947763255, -0.375752707130397, -0.628117092084732, -0.0771397060123765, -0.254476669776423, -0.426804051561118, -0.0543494208585616, 0.0966822722138057, -0.378019282271061, 0.191220933139707, -0.165924118783873, -0.213749511381794, -0.169030069661140, -0.388069550791445, -0.102578036219351, 0.0107042312132100, -0.00280101472189883, -0.449815492069174, -0.182381969190465, -0.0184081770597472, 0.519796098905983, -0.275251193030818, 0.460312944851645, -0.0988393807480281, 0.307538946701957, -0.137157928436657, -0.0415420282557249, 0.100309698213336, -0.391683559343043, -0.701487794785392, -0.235539505585071, -0.202906831134625, -0.358720649734220, -0.273801850307152, 0.241043954119213, -0.107111117631079, -0.355689319830292, -0.152870970164078, 0.132830183188965, 0.307022241073381, 0.385085731624083, 0.377964910643054, -0.660471912963889, 0.0101828770713443, -0.0719769229373373, -0.0939168322862893, 0.495655616897050, 0.417972134856035, 0.248956726460272, 0.0931599406215650, -0.915878750431348, -0.448068098805463, -0.00599875359094246, -0.417174453155380, 0.153874885309374, -0.165479864551428, -0.714318045551365, 0.0831745849066624, -0.0122166501201275, 0.0937782327742685, -0.276196805017001, -0.0913896450619296, -0.572863890415190, 0.160773312892671, 0.0873559527034507, -0.286110844848434, -0.0413717249450798, 0.456755779675317, 0.208918013113653, -0.936841918947510, -0.0877348762429930, -0.147987773334825, -0.196754465282255, -0.119149671044025, -0.908674665718181, -0.404288909930247, 0.000785331813092529, 0.725350694897478, 0.446554237777552, 0.108711935833606, -0.228430954364174, 0.118088815174554, 0.366921131989385, -0.418501695784466, -0.273568582297377, -0.318099941960815, 0.160664023319468, -0.104534876571329, -0.316831129749273, -0.000558750954569453, -0.321491505447654, 0.590692861087254, -0.0244874877096308, 0.539729912149986, -0.134697847374898, 0.821975099528638, 0.0215709224399271, -0.272687386022187, -0.0505671716737601, -0.107393561776319, 0.250491892878625, 0.332768068830157, -0.225632187079314, -0.531618838402154, 0.245386596644248, 0.346674668887682, 0.213756226133393, -0.780490727966221, -0.174782035173733, -0.147251571762949, -0.142293587115401, 0.104341426989502, -1.00753439639538, -0.139154690179601, -0.123492912348549, 0.258254951506323, -0.305001282076678, -0.357974777386955, -0.249774180551403, 0.539212636186858, 0.366163275900240, -0.354303634618339, -0.192214114817275, 0.192436716171194, 0.535107763819581, 0.163659741378950, 0.361538498164192, -0.664976104919082, -0.297628967996210, -0.246152777024781, -1.17871270055153, -0.448092863929758, -0.684100857014522, -0.0481763945366242, 0.317232794936549, -0.210491595631055, -0.476889282731800, -0.272429879974367, -0.0932818256495154, -0.376524409679812, 0.291918516204078, 0.618022581931328, 0.348844503491153, 0.258029779802510, -0.127495713880359, -0.0213120559072823, -0.435022825558794, -0.347014770198457, -0.238934028808522, -0.0372786813628945, -0.0416322750692615, -0.196838107659164, -0.417015333879439, -0.391527116321926, -0.476242223520796, -0.495985534262208, -0.355735094669541, -0.100320332032937, 0.342527131727847, 0.127235610452927, -0.388499395581771, 0.401932889767985, -0.466123991584607, -0.308973718690770, -0.415115753770714, 0.0848079413096732, -0.0773218362144685, 0.0976312961864815, 0.190162997205096, 0.0369928082458868, -0.275310970781289, 0.0599206281719417, -0.246159171366894, -0.0174632702391427, -0.458944444397858, -0.0803203809760213, -0.0439572401169625, -0.861776664814042, -0.0830864241798502, 0.369809691284922, -0.108729335642574, 0.111702280214897, -0.123247652233165, -0.908435251527107, -0.235643160881230, 0.730358988761290, -0.581766717539594, -0.536087323158504, 0.451055102148451, -0.619170133529155, 0.128119674748965, -0.0310649650007976, -0.312810435735001, -0.364576857329819, -0.0441426860402008, -0.524378001312223, 0.0524529131550334, -0.0643013673996127, 0.137282043935644, 0.260727707195480, 0.321231449169411, -0.332819091798046, -0.0513323635056377, -0.382907556325394, -0.347950342129311, -0.823688402812121, -0.655964306412315, -0.180406932979096, 0.342839477805131, 0.109889654931598, -0.343722522083553, 0.461155601792893, 0.437180969136961, -0.228725420495234, -0.125112776426800, -0.629192013556380, -0.260223093436007, 0.0432782014666878, -0.481236225798747, -0.173959303230280, 0.116466873625457, -0.104117014973111, -0.571039643640952, 0.180894028926413, -0.639876077795318, 0.266834644688797, -0.0136213378018435, -0.0619637564302935, -0.105882964849554, -0.672013885041268, 0.0183275572716894, -0.228763254383116, -0.109331310842426, -0.0974556810447207, 0.0864211479867550, -0.140165194075383, 0.189409587430688, -0.123375716334448, 0.0628633054016998, 0.625079055895960, -0.752536829955507, -0.0695161523420250, 0.284628592835893, -0.00617329998906764, 0.378583871127101, 0.330780722770157, 0.200326963666850, -0.158798326394184, 0.195302631038468, -0.214908433989653, -0.579960978435301, -0.368380095881974, -0.294920120015010, 0.0788279971011912, 0.623401996931321, -0.0595861007254502, 0.292148783010792, 0.303211445016866, 0.407833041652163, 0.0666540873161277, 0.707228680374402, -0.233507114419817, 0.253341855313063, -0.460866751757097, -0.196456068877344, 0.0114970022640086, 0.538489935499492, -0.677198140865361, -0.162465437642901, 0.0989587281587959, -0.109160500789064, -0.328337580320590, -0.475898062183903, -0.138708378500442, -0.0969644269857327, 0.452537731453390, -0.165804979606155, -0.231547305038543, 0.559052392168637, 0.559868133058650, 0.197911625093967, -0.160080833008026, 0.543262163775181, 0.442706053843120, -0.136798543892997, -0.00544343982740187, 0.359097198358597, -0.152220147907021, 0.427969113482364, -0.130245433191374, 0.0469259738822104, 0.384529092277554, -0.206816456273607, 0.245212617363919, 0.126568314082166, -0.0783326856527335, -0.0812753371186823, 0.580047891034084, 0.0281877527180876, 0.542470624662550, 0.494270774454885, -0.329611589140973, 0.0475691246564305, -0.458923192497633, 0.183485735758890, -0.780458681935069, 0.235333867620588, -0.182619524914603, 0.240024775457478, -0.273290317708421, -0.273977340802339, -0.286566093862879, -0.0214013402094027, -0.113104610986629, -0.695809437904363, -0.109403709823425, -0.656026831172984, 0.378794072282170, -0.334537764333997, 0.0519030267362396, 0.555494421182387, -0.177960846387091, -0.307502383787304, 0.404199472928923, -0.304328547338038, 0.232436398939993, 0.599339790678764, 0.256013145280962, 0.154031672508525, 0.467206903014798, 0.000318710629182175, -0.267930285754142, 0.433066528400875, -0.0401711018928796, -0.121274678511349, 0.410198825175900, -0.329138173420522, 0.120697897289405, 0.384680376022414, 0.258905316935134, -0.0457805698012488, -0.433839885605952, -0.0857649851131498, -0.168482017231136, 0.335655067465302, -0.509289750549717, -0.0855579992110226, 0.197298895180650, 0.0487465698686239, 0.714053042531226, -0.134717511572066, 0.0970208303559655, -0.0555399157359394, -0.148219569596104, 0.245427624667764, -0.0198281478691783, -0.0870350013860073, 0.242378165519916, 0.282526652474287, 0.511739391719345, 0.839539825596646, -0.391189841757719, -0.200917450668753, -0.483569226565748, -0.609417475162377, 0.171536567069715, -0.247213777616147, -0.0358098582476129, -0.409217417137450, -0.104395377585199, -0.0416213419684666, -0.639792491963636, -0.683045767671792, -0.499170592122610, -0.208991688584505, -1.03256396721034, -0.579840935858746, -1.16725204865966, 0.0176210616215510, -0.875346506820820, -0.591673075854851, -0.289398729940755, -0.290823483411712, -0.166047434055002, -0.764328735755235, -0.350681773234601, -0.681916864641632, -0.0737921729949926, -0.773604939731520, -0.159942547145780, -0.0798550202152612, -0.686219212626201, 0.138360688897451, -0.636799504152489, 0.557369501158918, 0.361117706180024, -0.0769239333597969, -0.321040105558788, -0.277257374044516, 0.105434702635828, -0.260702997287161, -0.488702484914361, -0.652518029479547, -0.310339780314131, -0.0116758131714677, -0.0152008852530463, -0.701759809739858, -0.0286211935544374, -0.243006531112575, -0.472838993674728, -0.312774882010713, -0.150053157843829, 0.491372595043358, 0.376198984196155, 0.181166886508094, -0.247407411737208, 0.434684542024358, -0.172541602529740, -0.0203343982663574, 0.128158759505100, -0.184345674539772, -0.491999274293946, -0.156052570513345, -0.113889821505948, -0.470644951950793, -0.523101143326008, -0.376893551433872, -0.271672849915521, 0.292797682905814, 0.0462763104904893, 0.131310831458577, 0.285196153153504, -0.728119074328021, -0.0181882376337621, 0.387844629557349, -0.0516302652562780, -0.169359581239101, -0.502862437466891, -0.314559012858992, -0.324023675327700, -0.166735414770670, 0.201290294120370, 0.398237371831720, -0.385770581825556, -0.427028265571294, 0.315655782196250, -0.750082622573718, 0.449394200548690, -0.499965186751706, -0.0375782271859022, -0.521069468264377, -0.0948476501503987, -0.946114610259626, -0.142868228541943, 0.187786278886400, -0.263193955722523, -0.862822084765328, -0.712542008359454, 0.224387648645180, -0.646004862143686, -0.177685017724463, -0.603316551890216, -0.410736202614763, -0.203029696590162, 0.257019299827143, 0.430882760782377, -0.130562961122031, 0.0474065270936546, -0.323669384252058, -0.377822922286378, -0.818777220497313, 0.432509615837268, 0.181850456700642, 0.109251853339103, -0.207310944172397, -0.0924514160533052, 0.373693601340056, -0.354129611851164, 0.0755195911671195, -0.406781414637955, 0.0819758641304936, -0.191077804051111, -0.0412941145606616, 0.0966547046454466, 0.0268742836531349, 0.663686385621667, -0.482789195127854, 0.0269852092444714, -0.595218957319404, 0.499944978156966, 0.520678619755733, -0.0969616335563855, -0.328271554674052, 0.0131812925375864, -0.395034594024470, 0.0230842567705798, -0.00723254818200300, -0.411028316076746, -0.366651091998001, -0.241917358690018, 0.186311025517082, 0.0153352705717135, 0.0118069804222628, -0.230132186845955, 0.0335529803740266, -0.451059779712755, -0.0366144101845365, -0.796666818912755, -0.553077237067743, 0.429692767968259, -0.268857070354682, -0.536331186631903, 0.0212456589245639, 0.152086996331202, -0.273927648360143, 0.212238211368769, 0.147586800584846, -0.178456119484814, -0.0269007998757578, 0.295359715539193, 0.152240434395975, 0.334341265480506, 0.0450188467452995, 0.237388964870659, 0.644248603486490, 0.0870306693257696, -0.667132139442231, -0.0507296085434860, 0.135898902876437, -0.331561732715685, 0.0891155880611099, 0.137822370794114, -0.181844928691872, 0.382119555179183, 0.255722482345144, 0.0770091669676393, 0.614656735415066, 0.143172907054576, 0.610489231404498, -0.431846405390474, 0.174944711266178, -0.172114181056260, 0.442265090818605, 0.404429741885925, 0.117817649991706, 0.00726514569055044, 0.639803702102143, -0.0910388665277584, 0.453751866953398, 0.428232144447582, 0.379936291966253, 0.109218936497978, 0.401930565270319, -0.0643079473997161, -0.202957502062524, -0.0790225643106751, -0.132567059673054, -0.662434379446230, 0.137376431733927, -0.298951118755263, 0.0504991853922039, 0.553875875900934, 0.0213879535273574, 0.307173038149628, -0.257017107563245, 0.0787857963709022, 0.0513851367661549, -0.523793284438781, -0.849896499756480, -0.574429665849668, -0.296174419507756, 0.0902404461607356, -0.156579354546014, -0.333810176653596, -0.232608135722454, -0.284959716922548, -0.0984027105204584, 0.568099795543918, 0.382503611860325, 0.00892319278812292, -0.127113139147884, -0.0863931025879484, -0.412324016527343, 0.451809507473570, -0.353365485374702, -0.482731468551769, -0.317090960567631, 0.552056647782357, -0.00797136054033625, -0.268133804381014, 0.353233598331004, -0.596834305061385, 0.0572700912502456, 0.259504347642023, 0.326608768950954, 0.590586660173174, 0.688725823709242, -0.272725167218681, 0.0256807629477441, -0.0898473400331852, -0.433985502592294, 0.181908027324134, -0.00112252247788649, -0.271505467749018, 0.188831529174095, 0.525819939068205, 0.357744209808004, 0.0589098441481897, 0.000912285299920145, 0.233420805248417, 0.0529200237632245, -0.472506488792624, 0.438314689145433, -0.808503577871023, -0.103048513592106, 0.0347302484872773, -0.0525544114893062, -0.00489684452173505, 0.323832085134601, -0.271433015270594, -0.214400342286703, 0.264066170751984, 0.561521220365174, 0.252541393431902, -0.146332523885770, -0.0208389416539708, -0.361975824681216, 0.00932000652150644, -0.280771134599888, -0.815993075934185, 0.800961539063059, -0.752306021776912, -0.611032732459952, 0.328809939390974, 0.0511897014596291, -0.0103429006002610, 0.162277413815334, 0.0411742683697157, -0.314773252168121, 0.493450511299358, 0.112343059654220, -0.341607077951823, 0.0363821930433832, 0.170710654087993, 0.0415131017894591, -0.424221060830718, 0.423685297237156, 0.587481413554574, -0.0804203703611701, 0.430844201234315, -0.332403737838475, 0.0988766239273883, 0.330623272680817, 0.426480771572383, 0.000733062001909977, 0.336812929180885, -0.0671650687514858, -0.418340240823735, 0.0195992639772667, -0.572585025731392, 0.133480192769086, -0.340266623403479, 0.185386282455904, -0.252173763048585, 0.124708236224613, -0.339909475066973, -0.354816026089915, 0.150923919330128, -0.654966281009933, -0.267086959219388, -0.210209131654157, -0.493161123660923, 0.208173525327448, -0.139556466751822, 1.10723439707710, -0.497148301218504, 0.0447994770277632, -0.208950697893914, 0.124182400521319, 0.194476823770902, 0.0354014216717710, 0.0659039694649250, 0.469589216536314, -0.187440177323853, -0.408243838197867, 0.460965208388027, -0.406763491013534, 0.281195491049678, -0.197640530754756, 0.0469981442019152, -0.0798886967527554, 0.100530708960174, 0.481588147137852, -0.193343826570645, 0.663067278795669, -0.116412069998591, -0.103441186743233, -0.143316938017681, -0.345588377416229, -0.248428149582990, 0.0159014805887852, 0.111059264146274, -0.275540641891931, 0.130950312290633, -0.262106981226039, 0.116256079702509, -0.229960746144847, -0.259835210279750, -0.241582190089953, 0.0127033011834414, -0.286500847181199, -0.353647225093956, 0.106675576586414, -0.305950708476641, 0.384537363072779, -0.296605136390773, 0.409111101027103, 0.127713266881954, -0.190735548192809, 0.341560580391356, -0.237068733624599, -0.0225623160726464, 0.395873228991836, -0.196680265675944, -0.285733437593960, 0.0645196778823507, -0.378310307340161, -0.210813907127701, -0.0711775566790917, 0.880201746715063, -0.231205291405034, 0.553824151319853, -0.486750108227228, -0.0687079954885234, 0.237472203218923, -0.560255102551189, 0.0437430773810981, 0.0886716964224062, -0.0230081744649081, 0.721022299822073, -0.0199371243645142, -0.330354279643151, 0.524507296282923, -0.350167961154516, 0.128479164381413, 0.0180318579488511, -1.04364590768443, -0.145332469497341, 0.0634479268163271, -0.289811545044926, -0.646296351832984, -0.400668035932944, 0.704558030443807, 0.582025306074374, 0.454374944942248, -0.176870883240262, 0.0476541337584911, 0.395235891480093, -0.379439092306109, -0.00500259284598204, -0.233431624707612, 0.333850413035894, 0.464784364330297, 0.0825718773544524, 0.476339483820533, 0.323908716092624, -0.335832350496322, -0.119758123155826, 0.656177266391749, 0.291393667158804, 0.690203968557624, -0.227147110824353, -0.717523847853612, -0.743951084878660, 0.371212055537266, 0.490622523416093, -0.412275744052049, 0.0729691183465222, -0.297985871734060, -0.295130397384034, 0.292316328043074, -0.144993670360062, -0.505396013754551, -0.000614548753043863, 0.192193265499423, 0.103001273100853, -0.000796250262148876, 0.729735070414541, 0.122502152711000, -0.278042308107985, 0.0482645526568746, -0.203457255235495, 0.645032692368137, -0.154195006746529, -0.103809119904774, -0.226262435893820, 0.220324244295662, 0.660689387862663, -0.260764402736072, -0.446067761117329, -0.608912194817094, 0.394229474397069, 0.133474826113833, -0.244537770532438, 0.0282102112519084, -0.0138492114098640, 0.245971851578331, -0.194637118008856, 0.0323009471672782, -0.0945182388507726, 0.0335507787322022, 0.393591666275608, -0.109817995338752, 0.0144422275529998, 0.355314881131981, 0.658907501592396, -0.151607884969735, 0.201545924820149, -0.0253498091768656, 0.296029944939544, 0.162690116370465, 0.172562126917048, -0.148996636636305, -0.232610748953160, 0.545301182692265, -0.291407534688981, -0.264534400734494, 0.0301195120940176, 0.0513345950261926, 0.252001748805644, -0.268332776319842, 0.103665915789856, 0.0638759267191437, 0.442505706332333, 0.329755527972981, 0.797297274951359, 0.0193570854001687, -0.0740445187277399, -0.238316726213456, 0.186202805299960, -0.0472393554449810, -0.405772648702442, 0.522979428023270, 0.664810170038400, -0.0854921573138209, 0.459546652855960, 0.521083962289635, -0.296391673269069, 0.347086341457332, 0.100777869348874, -0.213973355094611, 0.256760591328934, -0.448325392426232, -0.231389818791611, -0.134853825136636, 0.404800254156817, -0.101901961225822, 0.561918292255994, 0.335376736007389, 0.389702544947735, 0.174380643825782, 0.525216608839645, 0.312325937049581, 0.236937658014640, 0.181750627926702, 0.184970879867516, -0.167884714993826, 0.354525634441598, 0.0353163317777223, 0.245014107455065, -0.0109832488137977, 0.518421801720437, 0.193507880891129, 0.951984091456240, 0.208334092894048, 0.587372832926080, 0.615437578857295, 0.510623292482510, 0.500364575348994, 0.681485576998967, 0.163158239100990, -0.0752825275407957, 0.152768688466805, 0.876515971242777, -0.0162548750140655, 0.0390098958779767, -0.225708142876914, 0.312706562521545, 0.616258917696584, 0.0243696095881224, -0.601671858590759, -0.559204286689289, 0.574515456289262, 0.472084961550318, 0.287024943462664, 0.656754531817633, 0.348123085390440, -0.235990031403950, 0.321675894857912, -0.467264907151031, 0.588678298511701, 0.330638770637760, 0.112670910653878, 0.274411176704644, 0.445549487389380, 0.145974461132923, 0.480463314436959, -0.540781110347545, 0.286869544298566, 0.199254743249531, 0.398630182368985, 0.291607654417931, 0.262818752790650, -0.0290783449287557, 0.258997677825225, -0.0930897550788332, -0.0670708735546668, 0.0586768338520838, 0.261766445639907, 0.0776174258791927, 0.376696053975221, 0.531020891341788, 0.225266745239421, 0.508233073734862, 0.240303932295450, -0.563520429605506, 0.158468959657907, 0.865673909688700, 0.350319616560932, 0.333439306928440, 0.287573011830505, 0.326765325421609, 0.0952510541039374, -0.102065619466015, -0.147760082837459, -0.174254770911552, 0.331180194154221, -0.190794382990727, -0.278229298638774, 0.0470704883437145, 0.634317729480971, 0.164014172945674, -0.262608954448879, -0.0776163287716829, 0.0647955218817045, 0.0840673025279572, -0.102547963343684, 0.296113305858835, 0.417371531589239, 0.141252973254311, 0.0401459914402429, 0.140470806186873, -0.0853496277267392, -0.278473811961832, 0.293491746208525, 0.770875578936007, 0.294830575016862, -0.222740117242583, 0.370930653216385, 0.0663693880064497, 0.427235968642337, -0.00428026311356804, 0.204769470168794, 0.316290793177503, 1.03021461053437, 0.364580911596718, -0.502074806047003, 0.588365278739692, 0.274263135190716, -0.484597364658752, 0.308851379536838, 0.367005586127457, 0.0232548130159593, 0.145033712426709, 0.0732900964341152, 0.365738201409390, 0.475785090247714, -0.740827953368882, 0.271777067776258, 0.720790858185031, -0.179598161026373, 0.182999347394047, 0.0210893808908427, -0.160920518043011, -0.246731413019005, 0.243005240903786, -0.0102169081731261, 0.102192022081837, -0.0379754341873139, 0.0301486544642320, -0.309909309508999, 0.152320769061989, -0.122766580929853, 0.0594360579877203, 0.110699667234589, -0.256220406006641, 0.393401035200215, 0.0676036029091632, -0.0425021238583637, 0.274763632429960, 0.275123647795142, 0.487336165094856 };
}

FineDetection::~FineDetection()
{
	delete this->m_hog;
	delete[] this->m_w;
}

int FineDetection::get_weights(string filename, double* weights) {
	ifstream srcFile(filename, ios::in); //以文本模式打开in.txt备读
	if (!srcFile) { //打开失败
		cout << "error opening source file." << endl;
		return -1;
	}
	double temp_weight;
	int total = 0;
	while (srcFile >> temp_weight) {
		//可以像用cin那样用ifstream对象
		weights[total++] = temp_weight;
	}
	return 0;
}



#ifdef GET_DATA
void FineDetection::writeTxt(string name, vector<float> bboxes, vector<float> descriptors) {
	ofstream ofs;
	ofs.open(name, ios::app);
	char s[20];
	for (int i = 0; i < bboxes.size(); i++) {
		// sprintf_s(s, "%.2f", text.at(i));
		ofs << bboxes.at(i) << " ";
	}
	for (int i = 0; i < descriptors.size(); i++) {
		// sprintf_s(s, "%.2f", text.at(i));
		ofs << descriptors.at(i);
		if (i != descriptors.size() - 1) {
			ofs << " ";
		}
	}
	ofs << endl;
	ofs.close();
}
void FineDetection::run(string filename, Mat& img, vector<Rect>& targets, vector<Rect>& final_targets)
{
	for (int i = 0; i < targets.size(); i++)
	{
		// 扩充切片大小
		int x1 = targets[i].x - targets[i].width / 2;
		int y1 = targets[i].y - targets[i].height / 2;
		int x2 = targets[i].x + 3 * targets[i].width / 2;
		int y2 = targets[i].y + 3 * targets[i].height / 2;

		if (x1 < 0) x1 = 0; if (x2 >= img.cols) x2 = img.cols - 1;
		if (y1 < 0) y1 = 0; if (y2 >= img.rows) y2 = img.rows - 1;

		Mat patch = img(Range(y1, y2), Range(x1, x2));

		//string img_format;
		//提取目录和文件名
		int pos = filename.rfind("\\");
		string dir = filename.substr(0, pos);
		string name = filename.substr(pos, filename.length());
		string img_path = dir.substr(0, dir.rfind("\\")) + "\\patch_img" + name.substr(0, name.rfind(img_format)) + "_" + to_string(i) + ".jpg";
		string txt_path = dir.substr(0, dir.rfind("\\")) + "\\patch_txt" + name.substr(0, name.rfind(img_format)) + ".txt";
		imwrite(img_path, patch);
		vector<float> descriptors = get_hog_score(patch);
		vector<float> bboxes = { float(targets[i].x), float(targets[i].y), float(targets[i].x + targets[i].width), float(targets[i].y + targets[i].height) };
		writeTxt(txt_path, bboxes, descriptors);
	}
}
vector<float> FineDetection::get_hog_score(Mat& img)
{
	// 切片统一到相同大小
	Mat hogImg = img.clone();
	resize(hogImg, hogImg, Size(64, 64));

	// 提取HOG特征
	vector<float> descriptors;
	m_hog->compute(hogImg, descriptors, Size(1, 1), Size(0, 0));
	return descriptors;
}

#endif

#ifndef GET_DATA
void FineDetection::run(Mat& img, vector<Rect>& targets, vector<Rect>& final_targets)
{
	for (int i = 0; i < targets.size(); i++)
	{
		// 扩充切片大小
		int x1 = targets[i].x - targets[i].width / 2;
		int y1 = targets[i].y - targets[i].height / 2;
		int x2 = targets[i].x + 3 * targets[i].width / 2;
		int y2 = targets[i].y + 3 * targets[i].height / 2;

		if (x1 < 0) x1 = 0; if (x2 >= img.cols) x2 = img.cols - 1;
		if (y1 < 0) y1 = 0; if (y2 >= img.rows) y2 = img.rows - 1;

		Mat patch = img(Range(y1, y2), Range(x1, x2));

		// HOG+SVM分类器
		float confiScore = get_hog_score(patch);
		cout << confiScore << endl;

		if (confiScore > 0.)
		{
			final_targets.push_back(targets[i]);
		}
	}
}

float FineDetection::get_hog_score(Mat& img)
{
	// 切片统一到相同大小
	Mat hogImg = img.clone();
	resize(hogImg, hogImg, Size(64, 64));

	// 提取HOG特征
	vector<float> descriptors;
	m_hog->compute(hogImg, descriptors, Size(1, 1), Size(0, 0));

	// SVM
	float confiScore = 0.;
	for (int d_id(0); d_id < descriptors.size(); ++d_id)
	{
		confiScore += (float)m_w[d_id] * descriptors[d_id];
	}

	return confiScore;
}
#endif // !GET_DATA
